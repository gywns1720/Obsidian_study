
#REACT_HOOK_USEREDUCER

# useReducer
---
- ë³´í†µ useState í›…ì„ í˜¸ì¶œí•˜ì—¬ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ì§€ë§Œ ë³µì¡í•œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  ë³€ê²½í•  ë•ŒëŠ” ì»´í¬ë„ŒíŠ¸ì— ìƒíƒœ ë³€ê²½ ë¡œì§ì´ í¬í•¨ë˜ë¯€ë¡œ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ê°€ ë³µì¡í•´ì§‘ë‹ˆë‹¤.
- ì´ëŸ° ê²½ìš° useReducer ë¥¼ ì‚¬ìš©í•˜ë©´ ìƒíƒœì™€ ê´€ë ¨ëœ ë¡œì§ì„ ì»´í¬ë„ŒíŠ¸ ë°–ìœ¼ë¡œ ë¶„ë¦¬ ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë¦¬ë“€ì„œ ê°œë…

- ë°°ì—´ì˜ ë©”ì„œë“œ ì¤‘ reduce ë©”ì„œë“œì˜ ì¸ìë¡œ ì „ë‹¬ë˜ëŠ” í•¨ìˆ˜ë¡œë¶€í„° ìœ ë˜í•©ë‹ˆë‹¤.
- ë°°ì—´ì˜ ë°ì´í„°ë¥¼ ì´ìš©í•´ í•©ê³„ë¥¼ êµ¬í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œ ì´ë‹¤.

### ì‚¬ìš©ë°©ë²•

```tsx
// reducer : ë¦¬ë“€ì„œ í•¨ìˆ˜
// initalValue : í•©ê³„ë¥¼ êµ¬í•  ë•Œ ì´ˆê¸°ê°’ìœ¼ë¡œ ì„ íƒì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¸ì
reduce(reduce [, initalValue]);
```

- ê°„ë‹¨í•œ ì˜ˆì œ
```tsx

type MemberType = {
	name : string;
	point : number;
}

const familyMembers : Array<MemberType> = [
	{name : "í™ê¸¸ë™", point : 1000},
	{name : "ì„±ì¶˜í–¥", point : 3000},
	{name : "í™ì˜ˆì§€", point : 5000},
	{name : "í™ì² ìˆ˜", point : 10000}
];

const initalPoint = 1000;


const reducer = (totalPoint : number, member : MemberType) => {
	totalPoint += member.point;
	return totalPoint;
}


// ë¦¬ë“€ì„œ í•¨ìˆ˜ëŠ” ìˆœìˆ˜ í•¨ìˆ˜ ì…ë‹ˆë‹¤. 
// ìˆœìˆ˜ í•¨ìˆ˜ì˜ ì¡°ê±´
// 1. ì…ë ¥ ì¸ìê°€ ë™ì¼í•˜ë©´ ë¦¬í„´ê°’ë„ ë™ì¼
// 2. ë¶€ìˆ˜ íš¨ê³¼ê°€ ì—†ì–´ì•¼ í•œë‹¤.
// 3. í•¨ìˆ˜ì— ì „ë‹¬ë˜ëŠ” ì¸ìëŠ” ë¶ˆë³€ì„±ì„ ê°€ì ¸ì•¼ í•œë‹¤. (ì¸ì ë³€ê²½ ë¶ˆê°€)
const totalPoint = familyMembers.reduce(reducer, initalPoint);


```

---
## ë¦¬ë“€ì„œ í•¨ìˆ˜

- ìˆœìˆ˜ í•¨ìˆ˜ì—¬ì•¼ í•˜ê¸° ë•Œë¬¸ì— `state`, `action` ì„ ë³€ê²½í•´ì„œëŠ” ì•ˆ ë˜ê³ , ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë§Œë“¤ì–´ì„œ ë¦¬í„´í•´ì•¼ í•©ë‹ˆë‹¤.

```tsx
(state, action) => {
	// state ì™€ action ì„ ì´ìš©í•´ ì—°ì‚°ì„ ìˆ˜í–‰í•œ í›„ ìƒˆë¡œìš´ ìƒíƒœê°’ìœ¼ë¡œ ë¦¬í„´í•©ë‹ˆë‹¤. 
	return newState;
}
```

![[Reducer ì´ìš©ì‹œ ë¶ˆë³€ì„±ê³¼ ìƒíƒœë³€ê²½ì¶”ì ]]

---
## useReducer ì‚¬ìš©í•˜ê¸°

- useReducer ì‚¬ìš©í•˜ëŠ” ë°©ë²•

```tsx
/*
	state : ìƒíƒœê°’
	dispatch : ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ë©”ì„œë“œ
	reducer : ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë¦¬í„´í•˜ëŠ” ë¦¬ë“€ì„œ í•¨ìˆ˜
	initalState : ì´ˆê¸° ìƒíƒœë¡œ ì§€ì •í•  ê°ì²´
*/
const [state, dispatch] = useReducer(reducer, initialState);
```

- ì¶”ì²œí•  ë§Œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
```bash
# ë¶ˆë³€ì„± ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
npm install immer
```

- ë¦¬ì•¡íŠ¸ì—ì„œ ë°°ì—´ì´ë‚˜ ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸ í•  ë•Œ ì§ì ‘ ìˆ˜ì •í•˜ë©´ ì•ˆë˜ê³  ë¶ˆë³€ì„±ì„ ì§€ì¼œì£¼ë©´ì„œ ì—…ë°ì´íŠ¸ë¥¼ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
```ts
const stateObject = {a: 1, b : 2};
const stateTodos = [{id :1, text: "í• ì¼",done : true}, {id : 2, text : "ê¸ˆìª½", done : false}];

// ğŸš« Bad
stateObject.a = 3; 
stateTodos[0].id = 3;


// âœ… Good
const goodObject = {...stateObject, a : 3};
const inserted = stateTodos.concat({id : 3, text: "í• ì¼", done : false});
const filtered = stateTodes.filter(todo => todo.id !== 2);
const mapred = stateTodes.map(todo => todo.id === 2 ? {...todo, done : !todo.done,} : todo);
```

- immer ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ê°€ì •ì˜ ê°ì²´
```ts
const state = {
  posts: [
    {
      id: 1,
      title: 'ì œëª©ì…ë‹ˆë‹¤.',
      body: 'ë‚´ìš©ì…ë‹ˆë‹¤.',
      comments: [
        {
          id: 1,
          text: 'ì™€ ì •ë§ ì˜ ì½ì—ˆìŠµë‹ˆë‹¤.'
        }
      ]
    },
    {
      id: 2,
      title: 'ì œëª©ì…ë‹ˆë‹¤.',
      body: 'ë‚´ìš©ì…ë‹ˆë‹¤.',
      comments: [
        {
          id: 2,
          text: 'ë˜ ë‹¤ë¥¸ ëŒ“ê¸€ ì–´ì©Œê³  ì €ì©Œê³ '
        }
      ]
    }
  ],
  selectedId: 1
};
```

- immer ì—†ì´ í•  ê²½ìš°
```ts
const nextState = {
	...state,
	posts : state.posts.map(post => post.id === 1 ? {...post, comments : post.comments.concat({id : 3, text : "ìƒˆë¡œìš´ ëŒ“ê¸€"})} : post)
}
```

- immer ì‚¬ìš©í•œ ê²½ìš°
```ts
import produce from 'immer';
const nextState = produce(state, draft => {
	const post = draft.posts.find(post => post.id === 1);
	post.comments.push({
		id : 3,
		text: "ìƒˆë¡œìš´ ëŒ“ê¸€"
	})
})
```


### Example

```tsx

//todoReducer.tsx

import produce from 'immer';

export type TodoItemType = {id : number; todo : string};

// ì‹¤í–‰í•  ì•¡ì…˜ ë¦¬ìŠ¤íŠ¸ ì •ì˜
export const TODO_ACTION = {
	ADD : "addTodo",
	DELETE : "deleteTodo",
} as const;

// ì•¡ì…˜ ìƒì„± Dispatch ì— ë‹´ì„ ë°ì´í„° ì •ì˜
export const TodoActionCreator = {
	[TODO_ACTION.ADD] : (todo : string) => ({type : TODO_ACTION.ADD, payload : {todo : todo}}),
	[TODO_ACTION.DELETE] : (id : number) => ({type : TODO_ACTION.DELETE, payload: {id : id}})
};

// Dispatch ì— ë‹´ì„ ì•¡ì…˜ íƒ€ì… ì§€ì • (ì˜¤íƒ€ ë°©ì§€ìš©)
export type TodoActionType = ReturnType<typeof TodoActionCreator[TODO_ACTION.ADD]> | ReturnType<typeof TodoActionCreator[TODO_ACTION.DELETE]>

// Reducer ì œì‘
export const TodoReducer = (state : Array<TodoItemType), action : TodoActionType) => {
	switch(action.type) {
		case TODO_ACTION.ADD:
			return produce(state, (draft : Array<TodoItemType>) => {
				draft.push({id : new Date().getTime(), todo : action.payload.todo});
			})
		default:
			return state;
	}
}
```

```tsx
// App.tsx
import {useReducer} from 'react';
import {TodoActionCreator, TodoItemType, TodoReducer} from './todoReducer';

let isNow = new Date().getTime();

// ë§¨ ì²˜ìŒ ì´ˆê¸°ê°’
const initalTodoList : Array<TodoItemType> = [
	{
		id : idNow, todo : "ìš´ë™"
	},
	{
		id : idNow + 1, todo : "ë…ì„œ"
	},
	{
		id : idNow + 2, todo : "ìŒì•… ê°ìƒ"
	}
];


// ì»´í¬ë„ŒíŠ¸
const App = () => {
	const [todoList, dispatchTodoList] = useReducer(TodoReducer, initalTodoList);
	const [todo, setTodo] = useState("");

	// ì¶”ê°€ ì´ë²¤íŠ¸ í•¨ìˆ˜
	const onAddTodo = () => {
		// dispatch ë¥¼ í†µí•´ ë¦¬ë“€ì„œì— ìƒì„± ëª…ë ¹ì–´ ì „ë‹¬
		dispatchTodoList(TodoActionCreator.addTodo(todo));
		setTodo("");
	}

	// ì‚­ì œ ì´ë²¤íŠ¸ í•¨ìˆ˜
	const onDeleteTodo = (id : number) => {
		// dispatch ë¥¼ í†µí•´ ë¦¬ë“€ì„œì— ì‚­ì œ ëª…ë ¹ì–´ ì „ë‹¬
		dispatchTodoList(TodoActionCreator.deleteTodo(id));
	}

	return (
		<div>
			<input type="text" onChange={(e) => {
				setTodo(e.target.value)
			}} value={todo} />
			<button onClick={onAddTodo}>í• ì¼ ì¶”ê°€</button>
			
			<ul>
				{
					todoList.map((item, i) => {
						// todoList ë°°ì—´ ê°¯ìˆ˜ ë§Œí¼ HTML íƒœê·¸ ë§¤í•‘
						// map í•¨ìˆ˜ë¡œ html íƒœê·¸ ë§¤í•‘ì‹œ key ëŠ” ë¬´ì¡°ê±´ ì“°ê¸° ì•ˆì“°ë©´ ë¦¬ì•¡íŠ¸ê°€ ëœë”ë§ ìœ„ì¹˜ë¥¼ ëª»ì°¾ìŒ
						return <li key={`todo_item_${i}`}>
							<span>{item.todo}</span>
							<button onClick={() => {
								// ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ì‚­ì œ)
								onDeleteTodo(item.id);
							}}>ì‚­ì œ</button>
						</li>
					})
				}
			</ul>
		</div>
	)
}

```

